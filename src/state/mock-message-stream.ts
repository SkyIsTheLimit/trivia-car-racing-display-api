import { ArduinoMessagePacket } from 'src/arduino-state';
import { MessageStream } from './message-stream';
import { Logger } from '@nestjs/common';

const mockMessages: ArduinoMessagePacket[] = [
  // [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 3, 0, 0, 0],
  // [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  // [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  // [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  // [1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
  // [1, 1, 0, 0, 0, 1, 3, 0, 0, 0, 0, 0],
  // [1, 1, 0, 0, 0, 1, 3, 0, 0, 0, 0, 0],
  // [1, 2, 0, 0, 0, 1, 3, 0, 0, 0, 0, 0],
  // [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  // [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  // [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2],
  // [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 3, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0],
  // [0, 0, 0, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  // [1, 0, 0, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  // [1, 1, 0, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  // [1, 1, 0, 0, 0, 1, 0, 2, 2, 1, 0, 0, 0],
  // [1, 1, 0, 0, 0, 1, 2, 2, 2, 1, 0, 0, 0],
  // [1, 2, 0, 5, 8, 1, 2, 2, 2, 1, 0, 0, 0],
  // [2, 3, 0, 5, 8, 1, 2, 2, 2, 1, 0, 3, 0],
  // [2, 3, 0, 5, 8, 1, 2, 2, 2, 1, 1, 3, 0],

  [1, 1, 0, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 1, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 2, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 3, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 4, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 5, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 6, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 7, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 8, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],
  [1, 1, 9, 0, 0, 0, 0, 2, 1, 1, 0, 0, 0],

  [1, 1, 0, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 1, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 2, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 3, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 4, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 5, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 6, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 7, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 8, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],
  [1, 1, 9, 0, 0, 0, 0, 2, 2, 1, 0, 0, 0],

  [1, 1, 0, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 1, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 2, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 3, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 4, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 5, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 6, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 7, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 8, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
  [1, 1, 9, 0, 0, 0, 0, 2, 3, 1, 0, 0, 0],
];

export class MockMessageStream extends MessageStream {
  private readonly logger = new Logger(MockMessageStream.name);

  private intervalId: NodeJS.Timer;

  private messageNo = 0;
  private running = false;

  constructor() {
    super();
  }

  connect() {
    this.intervalId = setInterval(() => {
      const index = this.messageNo++ % mockMessages.length;
      const mock = mockMessages[index];
      const msg = `${mock.join(',')}`;

      this.logger.debug('Sending Message ' + msg);
      this.receiveMessage(msg);
    }, 2000);
    this.running = true;
  }

  disconnect() {
    clearInterval(this.intervalId);
    this.running = false;
  }

  isRunning() {
    return this.running;
  }

  send(message: string): void {
    // Do nothing
  }
}
